---
phase: 22-achievement-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/achievements.ts
  - src/stores/achievementStore.ts
autonomous: true

must_haves:
  truths:
    - "Achievement definitions are typed and exportable"
    - "Achievements persist across browser sessions"
    - "Store tracks unlocked achievements and current streak progress"
  artifacts:
    - path: "src/lib/achievements.ts"
      provides: "Achievement definitions and types"
      exports: ["Achievement", "MILESTONE_ACHIEVEMENTS", "HIDDEN_ACHIEVEMENTS", "ALL_ACHIEVEMENTS", "getNextMilestone"]
    - path: "src/stores/achievementStore.ts"
      provides: "Achievement state management"
      exports: ["useAchievementStore"]
  key_links:
    - from: "src/stores/achievementStore.ts"
      to: "src/lib/achievements.ts"
      via: "imports achievement definitions"
      pattern: "import.*achievements"
    - from: "src/stores/achievementStore.ts"
      to: "localStorage"
      via: "persist middleware"
      pattern: "persist\\("
---

<objective>
Create the achievement system foundation: type definitions, achievement data, and Zustand store with localStorage persistence.

Purpose: Establish the data layer for all achievement functionality. Other plans depend on this for definitions and state management.

Output: Achievement types, milestone/hidden achievement definitions, and a persistent store for tracking unlocked achievements.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-achievement-system/22-CONTEXT.md

# Existing patterns
@src/lib/personal-best.ts (localStorage pattern)
@src/stores/gauntletStore.ts (Zustand store pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Achievement definitions and types</name>
  <files>src/lib/achievements.ts</files>
  <action>
Create achievement type definitions and data:

1. Define Achievement interface:
   - id: string (kebab-case, e.g., "dice-apprentice")
   - name: string (display name, e.g., "Dice Apprentice")
   - description: string (what was accomplished)
   - icon: string (lucide icon name, e.g., "trophy", "skull", "target")
   - type: 'milestone' | 'hidden'
   - threshold?: number (for milestones - streak count needed)
   - condition?: string (for hidden - human-readable condition description for gallery)

2. Define MILESTONE_ACHIEVEMENTS array (5 achievements):
   - "dice-apprentice" at 5 (first milestone, encouraging)
   - "liars-bane" at 10 (getting serious)
   - "bluff-master" at 25 (skilled player)
   - "gauntlet-survivor" at 50 (impressive endurance)
   - "legend-of-lies" at 100 (ultimate achievement)

3. Define HIDDEN_ACHIEVEMENTS array (6-8 achievements):
   Risky victory category:
   - "last-die-standing": Win a duel with only 1 die remaining
   - "comeback-kid": Win a duel after being behind by 3+ dice

   Playstyle category:
   - "truth-seeker": Call DUDO correctly 5 times in a single run
   - "bold-bluffer": Win 3 rounds via opponent calling DUDO on your true bids
   - "calza-master": Successfully call Calza 3 times in a single run (if applicable)
   - "perfect-read": Call DUDO on exact count 3 times in a run

   Note: Claude has discretion on exact numbers and which achievements to include from these suggestions.

4. Export ALL_ACHIEVEMENTS combining both arrays.

5. Create helper function getNextMilestone(currentStreak: number): Achievement | null
   - Returns the next milestone achievement not yet reached
   - Returns null if all milestones achieved

6. Create helper function getProgressToNext(currentStreak: number): { current: number; target: number; achievement: Achievement } | null
   - Returns progress info for the next milestone
   - Returns null if all milestones achieved
  </action>
  <verify>
    - File compiles: `npx tsc --noEmit src/lib/achievements.ts`
    - All exports present: grep for exported names
  </verify>
  <done>
    - Achievement interface defined with all required fields
    - 5 milestone achievements with thematic names
    - 6-8 hidden achievements covering risky victory and playstyle categories
    - Helper functions for milestone progress
  </done>
</task>

<task type="auto">
  <name>Task 2: Achievement store with persistence</name>
  <files>src/stores/achievementStore.ts</files>
  <action>
Create Zustand store for achievement state management:

1. Define AchievementState interface:
   - unlockedAchievements: Map of achievement id to unlock date (ISO string)
   - runStats: Object tracking current run statistics for hidden achievements:
     - correctDudoCalls: number
     - bluffWins: number (opponent called DUDO on true bid)
     - calzaSuccesses: number
     - exactDudoCalls: number (called DUDO and count was exactly bid)
   - Note: runStats resets on new run, unlockedAchievements persists

2. Define actions:
   - unlockAchievement(id: string): void - marks achievement as unlocked with current timestamp
   - isUnlocked(id: string): boolean - checks if achievement is unlocked
   - getUnlockDate(id: string): string | null - returns ISO date string or null
   - resetRunStats(): void - clears run-specific stats for new gauntlet run
   - incrementStat(stat: keyof runStats): void - increments a run stat
   - getRunStat(stat: keyof runStats): number - gets current run stat value
   - loadFromStorage(): void - hydrate state from localStorage (SSR-safe)

3. Use Zustand persist middleware:
   - Storage key: 'gauntlet_achievements'
   - Only persist unlockedAchievements (runStats should reset)
   - Use partialize to exclude runStats from persistence
   - SSR-safe: check typeof window before localStorage access

4. Pattern to follow: See gauntletStore.ts for Zustand patterns, personal-best.ts for localStorage patterns.
  </action>
  <verify>
    - File compiles: `npx tsc --noEmit src/stores/achievementStore.ts`
    - Store exports correctly: grep for useAchievementStore
  </verify>
  <done>
    - Achievement store created with unlocked achievements map
    - Run stats tracking for hidden achievements
    - Persist middleware configured for achievements only
    - SSR-safe localStorage access
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation passes: `npm run build` or `npx tsc --noEmit`
2. Achievement definitions are importable from other files
3. Store can unlock, check, and persist achievements
4. localStorage key 'gauntlet_achievements' used for persistence
</verification>

<success_criteria>
- Achievement interface fully typed
- 5 milestone achievements with Perudo-themed names
- 6-8 hidden achievements for discovery
- Zustand store with persist middleware
- Helper functions for progress tracking
- All exports available for Plan 02 and 03
</success_criteria>

<output>
After completion, create `.planning/phases/22-achievement-system/22-01-SUMMARY.md`
</output>
