---
phase: 07-turn-timers
plan: 03
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - src/components/GameSettingsModal.tsx
  - src/shared/messages.ts
autonomous: false

must_haves:
  truths:
    - "Turn time options are 30s, 60s, 90s, 120s (no Unlimited)"
    - "Schema validation rejects turnTimeoutMs = 0"
    - "Default turn time is 30s"
  artifacts:
    - path: "src/components/GameSettingsModal.tsx"
      provides: "Updated turn time options without Unlimited"
      contains: "120000"
    - path: "src/shared/messages.ts"
      provides: "Updated schema min value for turnTimeoutMs"
      contains: "min(10000)"
  key_links:
    - from: "src/components/GameSettingsModal.tsx"
      to: "GameSettings"
      via: "TURN_TIME_OPTIONS array"
      pattern: "TURN_TIME_OPTIONS"
---

<objective>
Update GameSettingsModal to remove "Unlimited" option and add 120s option per CONTEXT.md decisions.

Purpose: Per user discussion, turn timers should always be enabled in multiplayer to keep games moving. Remove the option to disable timers (Unlimited = 0) and add a longer option (120s) for players who want more time.

Output: Settings modal shows 30s, 60s, 90s, 120s options. Schema validation prevents turnTimeoutMs = 0.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-turn-timers/07-CONTEXT.md

Key decision from CONTEXT.md:
- Remove "Unlimited" option entirely
- Available options: 30s, 60s, 90s, 120s
- Default: 30 seconds (fast-paced)

Current state (from code review):
- TURN_TIME_OPTIONS has { value: 0, label: 'Unlimited' }
- Schema allows turnTimeoutMs min of 10000 (10s)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update turn time options in GameSettingsModal</name>
  <files>src/components/GameSettingsModal.tsx</files>
  <action>
Update the TURN_TIME_OPTIONS constant:

From:
```typescript
const TURN_TIME_OPTIONS = [
  { value: 30000, label: '30s' },
  { value: 60000, label: '60s' },
  { value: 90000, label: '90s' },
  { value: 0, label: 'Unlimited' },
];
```

To:
```typescript
const TURN_TIME_OPTIONS = [
  { value: 30000, label: '30s' },
  { value: 60000, label: '60s' },
  { value: 90000, label: '90s' },
  { value: 120000, label: '120s' },
];
```

This removes the "Unlimited" (0) option and adds 120s (2 minutes) option.
  </action>
  <verify>
Grep for options: `grep -A4 "TURN_TIME_OPTIONS" src/components/GameSettingsModal.tsx`
No zero value: `grep "value: 0" src/components/GameSettingsModal.tsx` should return nothing
Has 120s: `grep "120000" src/components/GameSettingsModal.tsx`
  </verify>
  <done>
GameSettingsModal shows 30s, 60s, 90s, 120s options with no Unlimited option
  </done>
</task>

<task type="auto">
  <name>Task 2: Update schema validation to reject 0</name>
  <files>src/shared/messages.ts</files>
  <action>
The current schema already has `z.number().int().min(10000).max(120000)` but verify and update if needed.

In the UPDATE_SETTINGS client message schema, ensure turnTimeoutMs validation:
```typescript
turnTimeoutMs: z.number().int().min(10000).max(120000).optional(),
```

This ensures:
- Minimum 10000 (10 seconds) - prevents abuse
- Maximum 120000 (120 seconds) - matches new max option
- Zero is rejected

Note: The schema may already be correct. Verify and update max if it was previously lower.
  </action>
  <verify>
Check schema: `grep -B2 -A2 "turnTimeoutMs" src/shared/messages.ts`
Verify min: Schema should show min(10000)
Verify max: Schema should show max(120000)
  </verify>
  <done>
Schema validates turnTimeoutMs between 10000-120000ms, rejects 0
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Turn timer feature complete:
- Server schedules alarms for turn timeout
- AI takes over with conservative moves when player times out
- Timer UI shows countdown with color transitions and pulse
- Robot badge indicates AI-made moves
- Settings modal has 30s/60s/90s/120s options (no Unlimited)
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Open http://localhost:3000, create a multiplayer room
3. Open another browser tab/window and join the same room
4. Configure settings: verify only 30s, 60s, 90s, 120s options exist (no Unlimited)
5. Start game with 30s turn time

Timer countdown test:
6. Observe the timer bar above the bid UI
7. Watch it count down from 30 seconds
8. Verify color changes: green initially, yellow around 15s, red around 7s
9. Verify pulsing animation starts when bar turns red

Timeout AI test:
10. On your turn, intentionally let the timer expire (don't make a move)
11. Observe that an AI move is made automatically
12. Verify the robot badge appears next to the bid (small "Auto" indicator)
13. Verify next player's turn starts normally

Multi-round test:
14. Play through a few rounds with timers
15. Verify timer resets correctly each turn
16. Verify timer doesn't show during reveal phase

Edge case test:
17. Call Dudo before timer expires - verify no timeout occurs
18. Call Calza before timer expires - verify no timeout occurs
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. Settings modal options: `grep -A4 "TURN_TIME_OPTIONS" src/components/GameSettingsModal.tsx`
3. Schema validation: `grep "turnTimeoutMs" src/shared/messages.ts`
4. Human verification of full timer flow
</verification>

<success_criteria>
- GameSettingsModal shows 30s, 60s, 90s, 120s (no Unlimited)
- Schema rejects turnTimeoutMs = 0
- Human verification confirms:
  - Timer countdown works
  - Color transitions work (green -> yellow -> red)
  - Pulse animation works in final seconds
  - Timeout AI makes a move when time expires
  - Robot badge appears on AI moves
  - Timer resets correctly between turns
</success_criteria>

<output>
After completion, create `.planning/phases/07-turn-timers/07-03-SUMMARY.md`
</output>
