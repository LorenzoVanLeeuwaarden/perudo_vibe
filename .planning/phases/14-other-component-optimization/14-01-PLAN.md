---
phase: 14-other-component-optimization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/hooks/useReducedMotion.ts
  - src/hooks/useIsFirefox.ts
  - src/components/VictoryScreen.tsx
  - src/components/DefeatScreen.tsx
  - src/components/RevealPhase.tsx
  - src/components/CasinoLogo.tsx
  - src/components/DyingDie.tsx
  - src/app/page.tsx
  - src/components/DiceCup.tsx
autonomous: true

must_haves:
  truths:
    - "Users with prefers-reduced-motion enabled see simplified animations"
    - "VictoryScreen animations are optimized for 60fps (no animated text-shadow without guard)"
    - "DefeatScreen animations are optimized for 60fps (no animated filter without guard)"
    - "CasinoLogo letter animation is guarded for Firefox and reduced motion"
    - "DyingDie filter animation is guarded for Firefox and reduced motion"
    - "page.tsx dice container filter animation is guarded for Firefox and reduced motion"
    - "DiceCup.tsx waiting-state boxShadow animation is guarded for Firefox and reduced motion"
    - "No animated text-shadow, filter, boxShadow, or backdrop-filter remains unguarded in codebase"
  artifacts:
    - path: "src/hooks/useReducedMotion.ts"
      provides: "prefers-reduced-motion detection hook"
      exports: ["useReducedMotion"]
    - path: "src/hooks/useIsFirefox.ts"
      provides: "Firefox browser detection hook"
      exports: ["useIsFirefox"]
    - path: "src/components/VictoryScreen.tsx"
      provides: "Optimized victory screen with reduced motion support"
      contains: "useReducedMotion"
    - path: "src/components/DefeatScreen.tsx"
      provides: "Optimized defeat screen with reduced motion support"
      contains: "useReducedMotion"
    - path: "src/components/CasinoLogo.tsx"
      provides: "Logo with guarded textShadow animation"
      contains: "useSimplifiedAnimations"
    - path: "src/components/DyingDie.tsx"
      provides: "Die death animation with guarded filter"
      contains: "useSimplifiedAnimations"
    - path: "src/app/page.tsx"
      provides: "Main game page with guarded dice container filter animation"
      contains: "useSimplifiedAnimations"
    - path: "src/components/DiceCup.tsx"
      provides: "Dice cup with guarded waiting-state boxShadow animation"
      contains: "useSimplifiedAnimations"
  key_links:
    - from: "src/components/VictoryScreen.tsx"
      to: "src/hooks/useReducedMotion.ts"
      via: "import"
      pattern: "import.*useReducedMotion"
    - from: "src/components/CasinoLogo.tsx"
      to: "src/hooks/useIsFirefox.ts"
      via: "import"
      pattern: "import.*useIsFirefox"
    - from: "src/app/page.tsx"
      to: "src/hooks/useReducedMotion.ts"
      via: "import"
      pattern: "import.*useReducedMotion"
    - from: "src/components/DiceCup.tsx"
      to: "src/hooks/useReducedMotion.ts"
      via: "import"
      pattern: "import.*useReducedMotion"
---

<objective>
Optimize all remaining animated components for 60fps performance and add accessibility support via prefers-reduced-motion.

Purpose: Extend Phase 13 optimization patterns to VictoryScreen, DefeatScreen, RevealPhase, CasinoLogo, DyingDie, page.tsx, and DiceCup. Add prefers-reduced-motion support for accessibility compliance (A11Y-01).

Output: Shared hooks (useReducedMotion, useIsFirefox), updated components with combined Firefox + reduced motion guards.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-other-component-optimization/14-RESEARCH.md
@src/components/VictoryScreen.tsx
@src/components/DefeatScreen.tsx
@src/components/RevealPhase.tsx
@src/components/CasinoLogo.tsx
@src/components/DyingDie.tsx
@src/app/page.tsx
@src/components/DiceCup.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared animation hooks</name>
  <files>
    src/hooks/useReducedMotion.ts
    src/hooks/useIsFirefox.ts
  </files>
  <action>
Create two shared hooks for animation optimization:

1. Create `src/hooks/useReducedMotion.ts`:
```typescript
'use client';

import { useState, useEffect } from 'react';

export function useReducedMotion(): boolean {
  const [prefersReducedMotion, setPrefersReducedMotion] = useState(false);

  useEffect(() => {
    if (typeof window === 'undefined') return;

    const mediaQuery = window.matchMedia('(prefers-reduced-motion: reduce)');
    setPrefersReducedMotion(mediaQuery.matches);

    const handler = (event: MediaQueryListEvent) => {
      setPrefersReducedMotion(event.matches);
    };

    mediaQuery.addEventListener('change', handler);
    return () => mediaQuery.removeEventListener('change', handler);
  }, []);

  return prefersReducedMotion;
}
```

2. Create `src/hooks/useIsFirefox.ts`:
```typescript
'use client';

import { useMemo } from 'react';

export function useIsFirefox(): boolean {
  return useMemo(() => {
    if (typeof navigator === 'undefined') return false;
    return navigator.userAgent.toLowerCase().includes('firefox');
  }, []);
}
```

These hooks extract the duplicated Firefox detection from each component and add the new reduced motion detection.
  </action>
  <verify>
Run `tsc --noEmit` to verify no TypeScript errors.
Check files exist: `ls src/hooks/useReducedMotion.ts src/hooks/useIsFirefox.ts`
  </verify>
  <done>
Both hooks exist and export their functions. TypeScript compilation passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Victory, Defeat, RevealPhase with reduced motion support</name>
  <files>
    src/components/VictoryScreen.tsx
    src/components/DefeatScreen.tsx
    src/components/RevealPhase.tsx
  </files>
  <action>
Update these components to use shared hooks and add reduced motion support:

**VictoryScreen.tsx:**
1. Replace local `useIsFirefox` function with import from `@/hooks/useIsFirefox`
2. Import `useReducedMotion` from `@/hooks/useReducedMotion`
3. Create combined check: `const useSimplifiedAnimations = isFirefox || prefersReducedMotion;`
4. Update all existing `isFirefox` checks to use `useSimplifiedAnimations`:
   - Line 112, 137, 148: Particle systems (`if (useSimplifiedAnimations) return;`)
   - Line 210: Particle SVG rendering (`{!useSimplifiedAnimations && ...}`)
   - Line 345: Animated textShadow (`animate={useSimplifiedAnimations ? {} : {...}}`)
5. Add guard to animated background gradient (lines 197-206):
   ```typescript
   style={useSimplifiedAnimations ? {
     background: `radial-gradient(circle at 50% 50%, ${colorConfig.glow} 0%, transparent 50%)`,
   } : undefined}
   animate={useSimplifiedAnimations ? {} : {
     background: [/* existing animation */],
   }}
   ```

**DefeatScreen.tsx:**
1. Replace local `useIsFirefox` function with import from `@/hooks/useIsFirefox`
2. Import `useReducedMotion` from `@/hooks/useReducedMotion`
3. Create combined check: `const useSimplifiedAnimations = isFirefox || prefersReducedMotion;`
4. Update all existing `isFirefox` checks to use `useSimplifiedAnimations`:
   - Lines 40, 62: Ember system (`if (useSimplifiedAnimations) return;`)
   - Line 108-116: Animated background vignette
   - Line 142: Ember SVG rendering
   - Lines 199-209: Animated filter/scale
   - Lines 267-274: Animated textShadow

**RevealPhase.tsx:**
1. Replace local `useIsFirefox` function with import from `@/hooks/useIsFirefox`
2. Import `useReducedMotion` from `@/hooks/useReducedMotion`
3. Create combined check: `const useSimplifiedAnimations = isFirefox || prefersReducedMotion;`
4. Update existing `isFirefox` checks to use `useSimplifiedAnimations`:
   - Lines 113-117: Background/backdropFilter
   - Lines 199-209: Glow effect (already has Firefox guard, add reduced motion)
  </action>
  <verify>
Run `tsc --noEmit` to verify no TypeScript errors.
Run `npm run build` to verify build succeeds.
  </verify>
  <done>
All three components import shared hooks and use `useSimplifiedAnimations` for combined Firefox + reduced motion checks. No animated textShadow, filter, or backdrop-filter remains unguarded in these files.
  </done>
</task>

<task type="auto">
  <name>Task 3: Fix CasinoLogo, DyingDie, page.tsx, and DiceCup with animation guards</name>
  <files>
    src/components/CasinoLogo.tsx
    src/components/DyingDie.tsx
    src/app/page.tsx
    src/components/DiceCup.tsx
  </files>
  <action>
Add Firefox and reduced motion guards to components that currently lack them:

**CasinoLogo.tsx:**
1. Import hooks at top of file:
   ```typescript
   import { useIsFirefox } from '@/hooks/useIsFirefox';
   import { useReducedMotion } from '@/hooks/useReducedMotion';
   ```
2. Add hooks inside component function:
   ```typescript
   const isFirefox = useIsFirefox();
   const prefersReducedMotion = useReducedMotion();
   const useSimplifiedAnimations = isFirefox || prefersReducedMotion;
   ```
3. Update letter animation (lines 124-145) to guard textShadow:
   ```typescript
   {'FAROLEO'.split('').map((letter, i) => (
     <motion.span
       key={i}
       className="inline-block"
       style={{
         textShadow: `0 0 10px ${colorConfig.glow}, 0 0 20px ${colorConfig.glow}, 0 4px 0 ${colorConfig.shadow}`,
       }}
       animate={useSimplifiedAnimations
         ? { y: [0, -2, 0] }  // Gentler bounce only, no textShadow animation
         : {
             y: [0, -4, 0],
             textShadow: [
               `0 0 10px ${colorConfig.glow}, 0 0 20px ${colorConfig.glow}, 0 4px 0 ${colorConfig.shadow}`,
               `0 0 20px ${colorConfig.glow}, 0 0 40px ${colorConfig.glow}, 0 4px 0 ${colorConfig.shadow}`,
               `0 0 10px ${colorConfig.glow}, 0 0 20px ${colorConfig.glow}, 0 4px 0 ${colorConfig.shadow}`,
             ],
           }
       }
       transition={{
         duration: 2,
         repeat: Infinity,
         delay: i * 0.1,
         ease: 'easeInOut',
       }}
     >
       {letter}
     </motion.span>
   ))}
   ```
4. Consider guarding the decorative dot scale/opacity animations (lines 52-54) - these are minor but can add guards for consistency

**DyingDie.tsx:**
1. Import hooks at top of file:
   ```typescript
   import { useIsFirefox } from '@/hooks/useIsFirefox';
   import { useReducedMotion } from '@/hooks/useReducedMotion';
   ```
2. Add hooks inside component function:
   ```typescript
   const isFirefox = useIsFirefox();
   const prefersReducedMotion = useReducedMotion();
   const useSimplifiedAnimations = isFirefox || prefersReducedMotion;
   ```
3. Update vibrate phase animation (lines 82-90) to guard filter:
   ```typescript
   animate={useSimplifiedAnimations
     ? {
         scale: [1, 1.05, 0.95, 1.1, 0.9, 1.15],
         opacity: [1, 0.8, 0.6, 0.4],  // Fade instead of filter
       }
     : {
         scale: [1, 1.05, 0.95, 1.1, 0.9, 1.15],
         filter: [
           'saturate(1) brightness(1)',
           'saturate(0) brightness(0.5) sepia(1) hue-rotate(-50deg) saturate(6)',
         ],
       }
   }
   ```
4. Update explode phase (line 103) - change inline filter style to conditional:
   ```typescript
   style={useSimplifiedAnimations
     ? { opacity: 0.5 }
     : { filter: 'saturate(0) brightness(0.3) sepia(1) hue-rotate(-50deg) saturate(8)' }
   }
   ```

**page.tsx (dice container filter animation - lines 1668-1679):**
1. Import hooks at top of file (near other imports):
   ```typescript
   import { useIsFirefox } from '@/hooks/useIsFirefox';
   import { useReducedMotion } from '@/hooks/useReducedMotion';
   ```
2. Add hooks inside the Home component function:
   ```typescript
   const isFirefox = useIsFirefox();
   const prefersReducedMotion = useReducedMotion();
   const useSimplifiedAnimations = isFirefox || prefersReducedMotion;
   ```
3. Update the dice container motion.div (around line 1669) to guard animated filter:
   ```typescript
   <motion.div
     className="relative flex justify-center items-end"
     style={useSimplifiedAnimations ? {
       filter: `drop-shadow(0 0 18px ${PLAYER_COLORS[playerColor].glow})`,
     } : undefined}
     animate={useSimplifiedAnimations ? {} : {
       filter: [
         `drop-shadow(0 0 12px ${PLAYER_COLORS[playerColor].glow})`,
         `drop-shadow(0 0 25px ${PLAYER_COLORS[playerColor].glow})`,
         `drop-shadow(0 0 12px ${PLAYER_COLORS[playerColor].glow})`,
       ],
     }}
     transition={useSimplifiedAnimations ? undefined : { duration: 2, repeat: Infinity, ease: 'easeInOut' }}
   >
   ```
   This provides a static glow when simplified animations are active, preserving the visual effect without the expensive animated filter.

**DiceCup.tsx (waiting-state boxShadow animation - lines 314-323):**
1. Import hooks at top of file:
   ```typescript
   import { useIsFirefox } from '@/hooks/useIsFirefox';
   import { useReducedMotion } from '@/hooks/useReducedMotion';
   ```
2. Add hooks inside component function:
   ```typescript
   const isFirefox = useIsFirefox();
   const prefersReducedMotion = useReducedMotion();
   const useSimplifiedAnimations = isFirefox || prefersReducedMotion;
   ```
3. Update the waiting phase animate block to guard boxShadow animation:
   ```typescript
   animate={
     phase === 'waiting'
       ? useSimplifiedAnimations
         ? {
             borderColor: [colorConfig.shadow, colorConfig.bg, colorConfig.shadow],
             // Static boxShadow, only animate borderColor for subtle visual feedback
           }
         : {
             borderColor: [colorConfig.shadow, colorConfig.bg, colorConfig.shadow],
             boxShadow: [
               `inset 0 4px 40px rgba(0,0,0,0.7), 0 8px 0 0 #030f0f, 0 12px 30px rgba(0,0,0,0.5), 0 0 25px ${colorConfig.glow}`,
               `inset 0 4px 40px rgba(0,0,0,0.7), 0 8px 0 0 #030f0f, 0 12px 30px rgba(0,0,0,0.5), 0 0 45px ${colorConfig.glow}`,
               `inset 0 4px 40px rgba(0,0,0,0.7), 0 8px 0 0 #030f0f, 0 12px 30px rgba(0,0,0,0.5), 0 0 25px ${colorConfig.glow}`,
             ],
           }
       : phase === 'slamming'
       ? { /* existing slamming animation */ }
       : { /* existing default state */ }
   }
   ```
   Note: boxShadow animations are less expensive than filter animations, but guarding them ensures consistency across Firefox and reduced motion users.
  </action>
  <verify>
Run `tsc --noEmit` to verify no TypeScript errors.
Run `npm run build` to verify build succeeds.
Grep for unguarded expensive animations:
```bash
grep -n "animate.*textShadow" src/components/*.tsx src/app/page.tsx
grep -n "animate.*filter" src/components/*.tsx src/app/page.tsx
grep -n "animate.*boxShadow" src/components/*.tsx
```
All matches should be inside conditional blocks or use `useSimplifiedAnimations`.
  </verify>
  <done>
CasinoLogo, DyingDie, page.tsx, and DiceCup now have combined Firefox + reduced motion guards. No unguarded animated textShadow, filter, or boxShadow properties remain in the codebase.
  </done>
</task>

</tasks>

<verification>
After completing all tasks:

1. TypeScript compilation passes: `tsc --noEmit`
2. Build succeeds: `npm run build`
3. Audit for unguarded expensive animations:
   ```bash
   # These should show no matches outside conditional blocks:
   grep -rn "animate.*textShadow" src/
   grep -rn "animate.*filter" src/
   grep -rn "animate.*backdrop" src/
   grep -rn "animate.*boxShadow" src/
   ```
4. New hooks exist:
   ```bash
   ls src/hooks/useReducedMotion.ts src/hooks/useIsFirefox.ts
   ```
5. Components import shared hooks (no duplicate useIsFirefox definitions):
   ```bash
   grep -rn "function useIsFirefox" src/components/  # Should return nothing
   ```
</verification>

<success_criteria>
- [ ] `useReducedMotion` hook created and exported
- [ ] `useIsFirefox` hook extracted to shared location
- [ ] VictoryScreen uses `useSimplifiedAnimations` for all expensive animations
- [ ] DefeatScreen uses `useSimplifiedAnimations` for all expensive animations
- [ ] RevealPhase uses `useSimplifiedAnimations` for all expensive animations
- [ ] CasinoLogo textShadow animation guarded with `useSimplifiedAnimations`
- [ ] DyingDie filter animation guarded with `useSimplifiedAnimations`
- [ ] page.tsx dice container filter animation guarded with `useSimplifiedAnimations`
- [ ] DiceCup.tsx waiting-state boxShadow animation guarded with `useSimplifiedAnimations`
- [ ] No duplicate `useIsFirefox` definitions in component files
- [ ] Build passes without errors
- [ ] Requirements VICT-01, VICT-02, COMP-01, COMP-02, A11Y-01 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/14-other-component-optimization/14-01-SUMMARY.md`
</output>
