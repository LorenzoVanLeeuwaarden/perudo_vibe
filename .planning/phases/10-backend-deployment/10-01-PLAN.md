---
phase: 10-backend-deployment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/10-backend-deployment/DEPLOYED_URL.txt
autonomous: false
user_setup:
  - service: partykit
    why: "PartyKit deployment requires GitHub authentication"
    dashboard_config:
      - task: "Complete GitHub OAuth when browser opens"
        location: "Browser will open automatically during npx partykit login"

must_haves:
  truths:
    - "PartyKit server is deployed to Cloudflare Workers"
    - "WebSocket endpoint is accessible at public URL"
    - "Backend URL is documented for frontend configuration"
  artifacts:
    - path: ".planning/phases/10-backend-deployment/DEPLOYED_URL.txt"
      provides: "Production backend URL for Phase 11"
      contains: "partykit.dev"
  key_links:
    - from: "party/index.ts"
      to: "Cloudflare Workers"
      via: "npx partykit deploy"
      pattern: "Deployed to"
---

<objective>
Deploy PartyKit backend to production on Cloudflare Workers.

Purpose: Make the multiplayer WebSocket server accessible via public URL so the frontend can connect from anywhere.

Output: Live PartyKit deployment at `perudo-vibe.[username].partykit.dev` with URL documented for Phase 11 frontend configuration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-backend-deployment/10-RESEARCH.md
@partykit.json
@party/index.ts
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Authenticate with PartyKit</name>
  <action>
    PartyKit deployment requires GitHub OAuth authentication.

    Run `npx partykit login` - this will open a browser window for GitHub OAuth.

    IMPORTANT: This is a one-time authentication. After completing the OAuth flow,
    credentials are stored locally and won't be needed for subsequent deploys.
  </action>
  <instructions>
    1. Run the command: `npx partykit login`
    2. Browser will open to GitHub OAuth page
    3. Click "Authorize" to grant PartyKit access
    4. Return to terminal - you should see "Logged in" or similar success message
  </instructions>
  <resume-signal>Type "logged in" after completing GitHub authentication</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Deploy PartyKit Backend</name>
  <files>.planning/phases/10-backend-deployment/DEPLOYED_URL.txt</files>
  <action>
    Deploy the PartyKit server to Cloudflare Workers:

    1. Run `npx partykit deploy` from project root
    2. Capture the deployed URL from output (format: perudo-vibe.[username].partykit.dev)
    3. Wait up to 2 minutes for DNS/TLS provisioning if this is first deploy
    4. Save the URL (without protocol) to DEPLOYED_URL.txt for Phase 11 consumption

    Expected output format:
    ```
    Deployed to https://perudo-vibe.[username].partykit.dev
    ```

    The URL in DEPLOYED_URL.txt should be just the host:
    ```
    perudo-vibe.[username].partykit.dev
    ```

    Note: If deploy fails with "unknown error", retry once - intermittent issues are documented.
  </action>
  <verify>
    1. `npx partykit deploy` completes without error
    2. Output contains "Deployed to https://perudo-vibe"
    3. DEPLOYED_URL.txt contains the host (no https:// prefix)
    4. `npx partykit list` shows the deployment
  </verify>
  <done>
    PartyKit backend deployed to Cloudflare Workers, URL saved to DEPLOYED_URL.txt
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify WebSocket Endpoint</name>
  <files></files>
  <action>
    Verify the deployed backend is accessible:

    1. Read the URL from DEPLOYED_URL.txt
    2. Test HTTP endpoint: `curl -I https://[URL]` should respond (may be 426 Upgrade Required)
    3. Run `npx partykit tail` to confirm server is running and ready to receive connections
    4. Optionally check `npx partykit info` for deployment details

    Note: The endpoint expects WebSocket connections, so HTTP requests may return
    upgrade-required status - this is expected behavior confirming the server is live.
  </action>
  <verify>
    1. `curl -I https://[deployed-url]` returns a response (any 2xx/4xx confirms server is reachable)
    2. `npx partykit tail` connects successfully (Ctrl+C to exit)
    3. `npx partykit info` shows deployment details
  </verify>
  <done>
    WebSocket endpoint accessible at public URL, ready for frontend connection in Phase 11
  </done>
</task>

</tasks>

<verification>
**Phase 10 verification:**

1. **BACK-01** (Cloudflare account configured): SATISFIED
   - Managed PartyKit deployment handles infrastructure
   - Only GitHub OAuth required (completed in Task 1)

2. **BACK-02** (PartyKit deployed to Cloudflare Workers): SATISFIED
   - `npx partykit deploy` completed successfully
   - Deployment visible in `npx partykit list`

3. **BACK-03** (WebSocket endpoint accessible): SATISFIED
   - Public URL responds to requests
   - `npx partykit tail` connects to live server
</verification>

<success_criteria>
- [ ] `npx partykit login` completed (GitHub OAuth successful)
- [ ] `npx partykit deploy` completed without errors
- [ ] Deployment URL saved to `.planning/phases/10-backend-deployment/DEPLOYED_URL.txt`
- [ ] `curl -I https://[url]` returns a response
- [ ] `npx partykit tail` successfully connects to production server
</success_criteria>

<output>
After completion, create `.planning/phases/10-backend-deployment/10-01-SUMMARY.md` with:
- Deployed URL
- Verification results
- Any notes for Phase 11 (frontend configuration)
</output>
