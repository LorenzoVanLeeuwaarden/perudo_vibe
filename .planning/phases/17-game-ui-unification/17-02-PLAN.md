---
phase: 17-game-ui-unification
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/RevealPhase.tsx
autonomous: true

must_haves:
  truths:
    - "Multiplayer RevealPhase shows bid vs actual comparison like single-player"
    - "Matching dice are counted incrementally with visual feedback"
    - "Result block shows color-coded borders (green for success, red for failure)"
  artifacts:
    - path: "src/components/RevealPhase.tsx"
      provides: "Unified reveal phase layout matching single-player visual style"
      contains: "BID"
  key_links:
    - from: "src/components/RevealPhase.tsx"
      to: "Dice component"
      via: "bid dice display"
      pattern: "Dice.*value=\\{bid\\.value\\}"
---

<objective>
Unify RevealPhase styling with single-player visual patterns

Purpose: Make multiplayer reveal phase visually consistent with single-player. The structure remains an overlay, but the layout adopts single-player's bid vs actual comparison UI.

Output: RevealPhase.tsx updated with:
1. "BID vs ACTUAL" comparison blocks (like single-player)
2. Incremental dice counting animation
3. Color-coded result borders (green/red based on outcome)
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-game-ui-unification/17-CONTEXT.md
@.planning/phases/17-game-ui-unification/17-RESEARCH.md
@src/components/RevealPhase.tsx
@src/app/page.tsx (lines 1746-1876 for bid vs actual comparison pattern)
@src/components/Dice.tsx
@src/lib/types.ts (PLAYER_COLORS)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add bid vs actual comparison blocks</name>
  <files>src/components/RevealPhase.tsx</files>
  <action>
Add "BID vs ACTUAL" comparison blocks above the player hands display, matching single-player's reveal UI.

Reference single-player implementation (page.tsx lines 1746-1876):

1. Import Dice component from './Dice'

2. Add state for tracking counted dice:
   - `const [countedDice, setCountedDice] = useState<number>(0);`
   - Reset to 0 when step changes or on mount

3. Insert bid vs actual comparison section AFTER the title, BEFORE the player hands.

4. BID block structure (left side):
   - className: "flex-1 p-2 sm:p-4 rounded-lg bg-purple-deep/70 border-2 max-w-none sm:max-w-[200px]"
   - Border color: use last bidder's color from PLAYER_COLORS (derive from players who made the bid)
   - Header: "The Bid" with last bidder name in parentheses
   - Display bid.count dice using Dice component with size="xs"
   - Show count: "{bid.count}x"

5. VS divider (middle):
   - Pulsing "VS" text between the two blocks
   - Use animate={{ scale: [1, 1.2, 1] }} with infinite repeat

6. ACTUAL block structure (right side):
   - className: same as BID but with conditional border color
   - Border color logic (after counting complete):
     - For Calza: green if actualCount === bid.count, red otherwise
     - For Dudo: green if actualCount < bid.count (dudo was correct), red otherwise
   - Header: "Actual" with color matching border
   - During counting: show "?" pulsing
   - After step >= 4: show matching dice incrementally
   - Show count: "{actualCount}x" or "..." during counting

7. Layout: Use flex-col on mobile, flex-row on sm+ screens
   - className="flex flex-col sm:flex-row items-stretch justify-center gap-2 sm:gap-4 mb-4 sm:mb-6"

8. Integrate with existing step state machine:
   - step < 4: Show BID block, ACTUAL shows "?"
   - step >= 4: ACTUAL block populates with counted dice
   - skipped: Immediately show full state

Note: Keep the existing player hands display below this new section. The comparison gives overview, hands show detail.
  </action>
  <verify>
Run `npm run build` - should compile without errors
Visual check: RevealPhase shows "BID vs ACTUAL" comparison at top of overlay
  </verify>
  <done>
RevealPhase displays bid vs actual comparison with proper styling, incremental reveal, and color-coded borders matching single-player
  </done>
</task>

<task type="auto">
  <name>Task 2: Refine player hands display styling</name>
  <files>src/components/RevealPhase.tsx</files>
  <action>
Adjust the player hands display section to better match single-player's PlayerRevealCard grid layout.

1. Update the player hands container:
   - Change from "space-y-3" (vertical stack) to grid layout
   - className="grid grid-cols-2 gap-2 sm:flex sm:flex-wrap sm:justify-center sm:gap-4 mb-4 sm:mb-6"
   - This matches single-player's 2-column mobile, flexible desktop pattern

2. Update individual player cards:
   - Keep existing card structure but add consistent sizing
   - Each card should have min-width for consistent grid appearance
   - Use PLAYER_COLORS for border color (already done, verify it matches)

3. Add visual hierarchy:
   - Loser's card: Add thicker/brighter border (border-red-danger instead of border-red-danger/50)
   - Winner's card (for Calza): Add green border highlight

4. Ensure dice display within cards:
   - Matching dice should have glow effect (keep existing implementation)
   - Use useSimplifiedAnimations to guard glow animation

5. Remove redundant "Matching count badge" if the bid vs actual already shows totals
   - OR keep it but style consistently with single-player

6. Verify skip button positioning:
   - Should remain fixed bottom-right during animation
   - Should disappear when step >= 7 or skipped

The goal is visual alignment, not replacing the row-based display with PlayerRevealCard component (that would require more refactoring than necessary).
  </action>
  <verify>
Run `npm run build` - should compile without errors
Visual check: Player hands display in 2-column grid on mobile, flexible row on desktop
  </verify>
  <done>
RevealPhase player hands use grid layout matching single-player's responsive pattern, with consistent card styling
  </done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build`
2. Start dev server: `npm run dev`
3. Navigate to multiplayer game, play until dudo/calza is called
4. RevealPhase overlay shows:
   - "BID vs ACTUAL" comparison at top
   - BID block shows last bidder's color and dice
   - ACTUAL block reveals incrementally (or immediately if skipped)
   - Color-coded borders (green/red) after counting
   - Player hands in grid layout below
   - Skip button works during animation
   - Continue button appears at end
5. Compare with single-player reveal - should feel similar in structure
</verification>

<success_criteria>
- GAME-04 satisfied: RevealPhase styling matches single-player's visual patterns
- Build passes without errors
- Responsive layout works on mobile and desktop
- Animation timing feels consistent with single-player reveal
</success_criteria>

<output>
After completion, create `.planning/phases/17-game-ui-unification/17-02-SUMMARY.md`
</output>
