---
phase: 23-tutorial-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/stores/tutorialStore.ts
  - src/components/ModeSelection.tsx
  - src/app/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can click 'How to Play' button on main menu"
    - "Tutorial state is managed separately from main game state"
    - "Tutorial completion persists across browser sessions"
  artifacts:
    - path: "src/stores/tutorialStore.ts"
      provides: "Tutorial state management with Zustand"
      exports: ["useTutorialStore"]
    - path: "src/components/ModeSelection.tsx"
      provides: "How to Play button in secondary position"
      contains: "How to Play"
    - path: "src/app/page.tsx"
      provides: "Tutorial game state and screen rendering"
      contains: "Tutorial"
  key_links:
    - from: "src/components/ModeSelection.tsx"
      to: "src/app/page.tsx"
      via: "onSelectTutorial callback"
      pattern: "onSelectTutorial"
    - from: "src/app/page.tsx"
      to: "src/stores/tutorialStore.ts"
      via: "useTutorialStore import"
      pattern: "useTutorialStore"
---

<objective>
Create tutorial store and main menu entry point for the tutorial mode.

Purpose: Establish the foundation for tutorial mode - state management and user entry point. This enables users to access the tutorial and provides the state infrastructure that TutorialGameplay (Plan 02) will consume.

Output: Working "How to Play" button that transitions to tutorial mode screen.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-tutorial-foundation/23-CONTEXT.md
@.planning/phases/23-tutorial-foundation/23-RESEARCH.md
@src/stores/gauntletStore.ts
@src/components/ModeSelection.tsx
@src/app/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create tutorialStore with Zustand</name>
  <files>src/stores/tutorialStore.ts</files>
  <action>
Create a new Zustand store following the gauntletStore pattern:

```typescript
import { create } from 'zustand';

type TutorialScreen = 'gameplay' | 'complete';

interface TutorialState {
  // Screen management
  screen: TutorialScreen;

  // Step tracking (for Phase 24 progress indicator)
  currentStep: number;
  totalSteps: number;

  // Completion tracking
  isCompleted: boolean;

  // Actions
  startTutorial: () => void;
  advanceStep: () => void;
  setStep: (step: number) => void;
  completeTutorial: () => void;
  exitTutorial: () => void;
  resetTutorial: () => void;

  // Helpers
  hasCompletedBefore: () => boolean;
}
```

Implementation requirements:
- `startTutorial()`: Reset to step 0, set screen to 'gameplay'
- `advanceStep()`: Increment currentStep, check if at totalSteps to auto-complete
- `completeTutorial()`: Set screen to 'complete', persist to localStorage key `tutorial_completed`
- `exitTutorial()`: Reset all state to initial (clean exit for re-entry)
- `hasCompletedBefore()`: Check localStorage `tutorial_completed` flag

Use localStorage for persistence (matches existing achievement pattern). No SSR issues - use typeof window check.

Set `totalSteps: 8` as placeholder (actual steps defined in Plan 02 script).
  </action>
  <verify>
Run TypeScript check: `npx tsc --noEmit`
Verify file exists and exports useTutorialStore
  </verify>
  <done>
tutorialStore.ts exists with all state and actions, TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Add How to Play button to ModeSelection</name>
  <files>src/components/ModeSelection.tsx</files>
  <action>
Modify ModeSelection.tsx to add tutorial entry point:

1. Add `onSelectTutorial: () => void` to ModeSelectionProps interface

2. Add handler function following existing pattern:
```typescript
const handleSelectTutorial = useCallback(() => {
  if (selectedMode !== null) return; // Prevent double-click
  setSelectedMode('tutorial');
  setTimeout(() => {
    onSelectTutorial();
  }, 300); // Shorter delay - less dramatic than game modes
}, [selectedMode, onSelectTutorial]);
```

3. Add 'tutorial' to GameMode union: `type GameMode = 'ai' | 'multiplayer' | 'gauntlet' | 'tutorial' | null;`

4. Add "How to Play" button after the game mode buttons, in a secondary position:
- Smaller than main buttons (text link style, not card)
- Always visible (not localhost-gated like Gauntlet)
- Positioned below main buttons with margin-top
- Use subtle styling: `text-sm text-white-soft/60 hover:text-white-soft underline-offset-4 hover:underline transition-colors`
- Include HelpCircle icon from lucide-react

Button structure:
```tsx
<motion.button
  initial={{ opacity: 0 }}
  animate={{ opacity: selectedMode && selectedMode !== 'tutorial' ? 0 : 1 }}
  transition={{ delay: 0.8, duration: 0.3 }}
  onClick={handleSelectTutorial}
  disabled={selectedMode !== null}
  className="flex items-center justify-center gap-2 text-sm text-white-soft/60 hover:text-white-soft underline-offset-4 hover:underline transition-colors mt-6 disabled:cursor-default"
>
  <HelpCircle className="w-4 h-4" />
  How to Play
</motion.button>
```

The button should fade out when other modes are selected (like existing buttons do).
  </action>
  <verify>
Run dev server, visually confirm "How to Play" button appears below main game modes
Click button - should trigger callback (will error until page.tsx wired)
  </verify>
  <done>
"How to Play" button visible on main menu in secondary position, styled subtly, fades appropriately
  </done>
</task>

<task type="auto">
  <name>Task 3: Wire tutorial mode into page.tsx</name>
  <files>src/app/page.tsx</files>
  <action>
Modify page.tsx to support tutorial mode:

1. Add 'Tutorial' to GameState type near top of file:
```typescript
// Find the GameState usage and add Tutorial
// GameState likely includes: 'ModeSelection' | 'SinglePlayerLobby' | 'Playing' | etc.
// Add: | 'Tutorial'
```

2. Import tutorialStore (TutorialScreen added in Plan 03):
```typescript
import { useTutorialStore } from '@/stores/tutorialStore';
// NOTE: Do NOT import TutorialScreen here - Plan 03 will add it
```

3. In the ModeSelection component usage, add onSelectTutorial handler:
```typescript
const handleSelectTutorial = useCallback(() => {
  setGameState('Tutorial');
}, []);
```

4. Pass to ModeSelection:
```typescript
<ModeSelection
  onSelectAI={handleSelectAI}
  onSelectMultiplayer={handleSelectMultiplayer}
  onSelectGauntlet={handleSelectGauntlet}
  onSelectTutorial={handleSelectTutorial}  // Add this
  playerColor={playerColor}
/>
```

5. Add tutorial rendering in the main return (after GauntletModeScreen block):
```typescript
{gameState === 'Tutorial' && (
  <div className="fixed inset-0 z-50">
    {/* TutorialScreen imported from Plan 03 - placeholder for now */}
    <div className="flex items-center justify-center h-full">
      <p className="text-white-soft">Tutorial mode - coming in Plan 03</p>
      <button onClick={() => setGameState('ModeSelection')} className="ml-4 underline">
        Back
      </button>
    </div>
  </div>
)}
```

This placeholder will be replaced in Plan 03 with actual TutorialScreen component.

6. Add exit handler for tutorial:
```typescript
const handleExitTutorial = useCallback(() => {
  useTutorialStore.getState().exitTutorial();
  setGameState('ModeSelection');
}, []);
```
  </action>
  <verify>
Run dev server: `npm run dev`
Click "How to Play" - should show placeholder tutorial screen
Click "Back" - should return to mode selection
No TypeScript errors: `npx tsc --noEmit`
  </verify>
  <done>
Tutorial mode accessible from main menu, transitions to placeholder screen, can exit back to menu
  </done>
</task>

</tasks>

<verification>
1. `npm run dev` starts without errors
2. Main menu shows "How to Play" button in secondary position below game modes
3. Clicking "How to Play" transitions to Tutorial game state
4. Tutorial state can be exited back to main menu
5. `npx tsc --noEmit` passes
6. `npm run lint` passes
</verification>

<success_criteria>
- tutorialStore.ts exists with Zustand store managing screen/step/completion state
- ModeSelection.tsx has "How to Play" button with proper styling and callback
- page.tsx handles 'Tutorial' game state and renders placeholder
- All TypeScript compiles, lint passes
- User can navigate: Main Menu -> Tutorial -> Main Menu
</success_criteria>

<output>
After completion, create `.planning/phases/23-tutorial-foundation/23-01-SUMMARY.md`
</output>
