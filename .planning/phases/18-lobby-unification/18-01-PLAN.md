---
phase: 18-lobby-unification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/LobbyLayout.tsx
  - src/components/LeaveConfirmDialog.tsx
  - src/app/page.tsx
  - src/components/index.ts
autonomous: true

must_haves:
  truths:
    - "Single-player lobby displays with unified panel structure (header with back button, scrollable content zone, footer with action button)"
    - "Single-player lobby uses static gradient background instead of animated shader"
    - "Back button in single-player returns to mode selection without confirmation"
    - "Start Game button is fixed at bottom of panel"
    - "Settings and opponent count are inline in content zone"
  artifacts:
    - path: "src/components/LobbyLayout.tsx"
      provides: "Unified lobby layout foundation with header/content/footer zones"
      exports: ["LobbyLayout"]
    - path: "src/components/LeaveConfirmDialog.tsx"
      provides: "Confirmation dialog for leaving multiplayer lobby"
      exports: ["LeaveConfirmDialog"]
    - path: "src/app/page.tsx"
      provides: "Single-player lobby using LobbyLayout"
      contains: "LobbyLayout"
  key_links:
    - from: "src/app/page.tsx"
      to: "src/components/LobbyLayout.tsx"
      via: "import and render"
      pattern: "import.*LobbyLayout"
---

<objective>
Create the unified LobbyLayout foundation and integrate single-player lobby.

Purpose: Establish the shared layout structure (header/content/footer) that both lobbies will use, then migrate single-player as the simpler first integration.

Output: LobbyLayout component with props for customization, LeaveConfirmDialog for multiplayer use, single-player lobby rendered via LobbyLayout.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-lobby-unification/18-CONTEXT.md
@.planning/phases/18-lobby-unification/18-RESEARCH.md

@src/components/KickConfirmDialog.tsx (pattern for LeaveConfirmDialog)
@src/components/ShaderBackground.tsx (static gradient pattern lines 148-163)
@src/app/page.tsx (current single-player lobby lines 1393-1501)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LobbyLayout and LeaveConfirmDialog components</name>
  <files>
    src/components/LobbyLayout.tsx
    src/components/LeaveConfirmDialog.tsx
    src/components/index.ts
  </files>
  <action>
Create `src/components/LobbyLayout.tsx`:

```typescript
interface LobbyLayoutProps {
  title: string;               // "Single Player" or lobby title
  onBack: () => void;          // Back button handler
  confirmBack?: boolean;       // If true, show LeaveConfirmDialog
  backConfirmTitle?: string;   // Dialog title (default: "Leave Lobby?")
  backConfirmMessage?: string; // Dialog message
  children: React.ReactNode;   // Content zone
  footer: React.ReactNode;     // Action buttons zone (Start Game)
  headerRight?: React.ReactNode; // Optional right side of header (connection status)
}
```

Structure (per CONTEXT.md):
- Static gradient background (extract CSS from ShaderBackground simplified mode):
  ```css
  radial-gradient(ellipse at 30% 20%, rgba(45, 212, 191, 0.08) 0%, transparent 50%),
  radial-gradient(ellipse at 70% 80%, rgba(236, 72, 153, 0.06) 0%, transparent 50%),
  radial-gradient(ellipse at center, hsl(175, 50%, 10%) 0%, hsl(175, 40%, 4%) 70%, hsl(175, 35%, 2%) 100%)
  ```
- CasinoLogo at top (outside panel, like current lobbies)
- retro-panel container with:
  - Header: flex row with back button (left), title (center), headerRight slot (right)
  - Content zone: `flex-1 overflow-y-auto` for scrollable content
  - Footer zone: `flex-none pt-4 mt-auto border-t border-purple-mid` for action button

Back button styling (match existing): `px-2 py-1.5 sm:px-3 sm:py-2 rounded-lg bg-purple-deep/80 border border-purple-mid text-white-soft/70 text-xs sm:text-sm flex items-center gap-1 sm:gap-2`

Use `useState` for `showLeaveConfirm` when `confirmBack` is true. When back is clicked and confirmBack is true, show dialog instead of calling onBack directly.

Create `src/components/LeaveConfirmDialog.tsx`:
- Based on KickConfirmDialog pattern
- Props: `isOpen`, `title` (default "Leave Lobby?"), `message` (default "You will be removed from the game room."), `onConfirm`, `onCancel`
- Same modal styling as KickConfirmDialog: `retro-panel p-6 max-w-sm w-full mx-4`
- Buttons: "Cancel" (bg-purple-mid) and "Leave" (bg-red-danger)

Add both exports to `src/components/index.ts`.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Exports exist: `grep -E "LobbyLayout|LeaveConfirmDialog" src/components/index.ts`
  </verify>
  <done>
LobbyLayout component exists with header/content/footer zones, static background, and optional leave confirmation.
LeaveConfirmDialog component exists matching KickConfirmDialog pattern.
Both exported from barrel file.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate single-player lobby with LobbyLayout</name>
  <files>src/app/page.tsx</files>
  <action>
Refactor the single-player "Lobby" gameState section (lines ~1393-1501) to use LobbyLayout:

1. Replace the current structure with:
```tsx
{gameState === 'Lobby' && (
  <LobbyLayout
    title="Single Player"
    onBack={quitGame}
    confirmBack={false}
    footer={
      <motion.button
        whileHover={{ scale: 1.05, y: -2 }}
        whileTap={{ scale: 0.98, y: 0 }}
        onClick={startGame}
        className="retro-button flex items-center gap-2 mx-auto text-sm sm:text-base px-4 py-2 sm:px-6 sm:py-3"
        style={{
          background: colorConfig.bgGradient,
          border: `2px solid ${colorConfig.border}`,
          borderBottom: `4px solid ${colorConfig.shadow}`,
          boxShadow: `0 4px 0 0 ${colorConfig.shadowDark}, 0 6px 10px 0 rgba(0, 0, 0, 0.5)`,
        }}
      >
        <Play className="w-4 h-4 sm:w-5 sm:h-5" />
        START GAME
      </motion.button>
    }
  >
    {/* Content: Dices icon, opponent selector, preview dice + settings */}
    <div className="text-center">
      <Dices className="w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-3 sm:mb-4" style={{ color: colorConfig.bg }} />

      {/* Opponent count selection - keep existing implementation */}
      <div className="mb-4 sm:mb-6">
        {/* ... existing opponent selector JSX ... */}
      </div>

      {/* Preview dice with settings button - keep existing implementation */}
      <div className="flex items-center justify-center gap-3 sm:gap-4">
        {/* ... existing preview dice + settings gear JSX ... */}
      </div>
    </div>
  </LobbyLayout>
)}
```

2. Remove the wrapping motion.div (LobbyLayout handles animations)
3. Remove the inline retro-panel div (LobbyLayout provides this)
4. Remove the inline back button (LobbyLayout provides this in header)
5. Keep ALL content inside (Dices icon, opponent selector, dice preview, settings gear)
6. Move Start Game button to footer prop

Import LobbyLayout at top: `import { LobbyLayout } from '@/components/LobbyLayout';`
  </action>
  <verify>
Run dev server: `npm run dev` (should compile without errors)
Visual check: Navigate to single-player lobby, verify:
- Static gradient background (not animated shader)
- Back button in header (top-left of panel)
- Opponent selector and settings visible
- Start Game button at bottom of panel
  </verify>
  <done>
Single-player lobby renders via LobbyLayout with:
- Static gradient background
- Back button in unified header
- Content zone with opponent selector and settings
- Footer with Start Game button
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes (TypeScript compiles)
- Single-player lobby displays with unified structure
- Background is static gradient (no animated shader)
- Back button in header returns to mode selection
- Start Game button is at bottom of panel
- Opponent selector and settings gear remain functional
</verification>

<success_criteria>
- LobbyLayout component created with header/content/footer zones
- LeaveConfirmDialog component created (for Plan 02 use)
- Single-player lobby refactored to use LobbyLayout
- Visual structure matches CONTEXT.md decisions
- No regressions in single-player lobby functionality
</success_criteria>

<output>
After completion, create `.planning/phases/18-lobby-unification/18-01-SUMMARY.md`
</output>
