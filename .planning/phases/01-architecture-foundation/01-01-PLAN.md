---
phase: 01-architecture-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - package-lock.json
  - src/shared/.gitkeep
  - src/stores/.gitkeep
  - party/.gitkeep
  - partykit.json
autonomous: true
user_setup: []

must_haves:
  truths:
    - "npm install completes without errors"
    - "partykit, partysocket, zustand, zod, nanoid are in package.json dependencies"
    - "src/shared/ directory exists for shared types"
    - "src/stores/ directory exists for Zustand stores"
    - "party/ directory exists for PartyKit server"
    - "partykit.json configuration file exists"
  artifacts:
    - path: "package.json"
      provides: "New dependencies"
      contains: "partykit"
    - path: "partykit.json"
      provides: "PartyKit configuration"
      min_lines: 5
    - path: "src/shared/.gitkeep"
      provides: "Shared types directory"
    - path: "src/stores/.gitkeep"
      provides: "Zustand stores directory"
    - path: "party/.gitkeep"
      provides: "PartyKit server directory"
  key_links: []
---

<objective>
Install multiplayer infrastructure dependencies and create project structure for Phase 1 architecture foundation.

Purpose: Establish the base dependencies and folder structure that all subsequent multiplayer development depends on. Without this foundation, no types, stores, or server code can be written.

Output: Project with partykit, partysocket, zustand, zod, and nanoid installed; new directories for shared types, Zustand stores, and PartyKit server; PartyKit configuration file.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-architecture-foundation/01-CONTEXT.md
@.planning/phases/01-architecture-foundation/01-RESEARCH.md
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install multiplayer dependencies</name>
  <files>package.json, package-lock.json</files>
  <action>
    Install the required dependencies for multiplayer infrastructure:

    ```bash
    npm install partykit partysocket zustand zod nanoid
    ```

    These are:
    - partykit: WebSocket server with edge deployment and room abstractions
    - partysocket: WebSocket client with auto-reconnect
    - zustand: Client-side state management (replaces 40+ useState hooks)
    - zod: Runtime validation and type inference for message protocol
    - nanoid: Room code generation with custom alphabets

    All should be regular dependencies (not devDependencies) as they're used at runtime.
  </action>
  <verify>
    Run `npm list partykit partysocket zustand zod nanoid` - all should be listed without errors.
    Run `cat package.json | grep -A 10 '"dependencies"'` - all five packages should appear.
  </verify>
  <done>
    package.json contains partykit, partysocket, zustand, zod, and nanoid in dependencies section.
    npm install completed without errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create project structure and PartyKit config</name>
  <files>src/shared/.gitkeep, src/stores/.gitkeep, party/.gitkeep, partykit.json</files>
  <action>
    Create the directory structure for multiplayer code:

    1. Create `src/shared/` directory with .gitkeep:
       - This will hold shared TypeScript types and Zod schemas
       - Importable by both PartyKit server (party/) and Next.js client (src/)

    2. Create `src/stores/` directory with .gitkeep:
       - This will hold Zustand stores
       - gameStore.ts for server-synced state
       - uiStore.ts for client-only UI state

    3. Create `party/` directory with .gitkeep:
       - This will hold PartyKit server code
       - At project root level (not inside src/)

    4. Create `partykit.json` at project root:
       ```json
       {
         "$schema": "https://www.partykit.io/schema.json",
         "name": "perudo-vibe",
         "main": "party/index.ts",
         "compatibilityDate": "2024-01-01"
       }
       ```

    The .gitkeep files ensure empty directories are tracked by git.
  </action>
  <verify>
    Run `ls -la src/shared/ src/stores/ party/` - all directories should exist.
    Run `cat partykit.json` - should show valid JSON with name, main, and compatibilityDate.
    Run `npx partykit --help` - should show PartyKit CLI help (confirms partykit installed correctly).
  </verify>
  <done>
    - src/shared/ directory exists
    - src/stores/ directory exists
    - party/ directory exists
    - partykit.json exists with valid configuration pointing to party/index.ts
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npm list partykit partysocket zustand zod nanoid` shows all packages
2. `ls src/shared src/stores party partykit.json` shows all exist
3. `cat partykit.json` shows valid PartyKit configuration
</verification>

<success_criteria>
- All five dependencies installed and listed in package.json
- Directory structure created: src/shared/, src/stores/, party/
- partykit.json exists with valid configuration
- Project still builds with `npm run build` (no breaking changes)
</success_criteria>

<output>
After completion, create `.planning/phases/01-architecture-foundation/01-01-SUMMARY.md`
</output>
