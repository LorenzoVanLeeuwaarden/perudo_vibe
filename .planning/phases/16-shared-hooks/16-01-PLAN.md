---
phase: 16-shared-hooks
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/DudoOverlay.tsx
  - src/components/ShaderBackground.tsx
  - src/components/DiceRoller3D.tsx
autonomous: true

must_haves:
  truths:
    - "A single useIsFirefox hook exists in /src/hooks/ and is the only Firefox detection in the codebase"
    - "DudoOverlay, ShaderBackground, and DiceRoller3D all import from the shared hook"
    - "All three components respect prefers-reduced-motion via useReducedMotion hook"
    - "No duplicate Firefox detection logic remains in component files"
  artifacts:
    - path: "src/hooks/useIsFirefox.ts"
      provides: "Shared Firefox browser detection"
      unchanged: true
    - path: "src/hooks/useReducedMotion.ts"
      provides: "Shared reduced motion preference detection"
      unchanged: true
    - path: "src/components/DudoOverlay.tsx"
      provides: "DUDO/CALZA overlay animation"
      contains: "import { useIsFirefox } from '@/hooks/useIsFirefox'"
    - path: "src/components/ShaderBackground.tsx"
      provides: "Animated background canvas"
      contains: "import { useIsFirefox } from '@/hooks/useIsFirefox'"
    - path: "src/components/DiceRoller3D.tsx"
      provides: "3D dice rolling animation"
      contains: "import { useIsFirefox } from '@/hooks/useIsFirefox'"
  key_links:
    - from: "src/components/DudoOverlay.tsx"
      to: "src/hooks/useIsFirefox.ts"
      via: "import statement"
      pattern: "import.*useIsFirefox.*from.*@/hooks/useIsFirefox"
    - from: "src/components/DudoOverlay.tsx"
      to: "src/hooks/useReducedMotion.ts"
      via: "import statement"
      pattern: "import.*useReducedMotion.*from.*@/hooks/useReducedMotion"
    - from: "src/components/ShaderBackground.tsx"
      to: "src/hooks/useIsFirefox.ts"
      via: "import statement"
      pattern: "import.*useIsFirefox.*from.*@/hooks/useIsFirefox"
    - from: "src/components/DiceRoller3D.tsx"
      to: "src/hooks/useIsFirefox.ts"
      via: "import statement"
      pattern: "import.*useIsFirefox.*from.*@/hooks/useIsFirefox"
---

<objective>
Migrate DudoOverlay, ShaderBackground, and DiceRoller3D to use shared hooks from /src/hooks/, eliminating duplicate Firefox detection logic and adding reduced motion support.

Purpose: Centralize browser detection and accessibility hooks to reduce code duplication and ensure consistent behavior across all animated components.

Output: Three updated component files using shared hooks with the established `useSimplifiedAnimations` pattern.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-shared-hooks/16-RESEARCH.md

# Existing shared hooks (do not modify)
@src/hooks/useIsFirefox.ts
@src/hooks/useReducedMotion.ts

# Components to migrate
@src/components/DudoOverlay.tsx
@src/components/ShaderBackground.tsx
@src/components/DiceRoller3D.tsx

# Reference: Components already using the pattern
@src/components/VictoryScreen.tsx (example of established pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate components to shared hooks</name>
  <files>
    src/components/DudoOverlay.tsx
    src/components/ShaderBackground.tsx
    src/components/DiceRoller3D.tsx
  </files>
  <action>
Migrate each component following the established `useSimplifiedAnimations` pattern used by 7 other components in the codebase.

**DudoOverlay.tsx:**
1. Remove local `useIsFirefox` function (lines 15-21)
2. Remove `useMemo` from imports (no longer needed for local hook)
3. Add imports:
   ```typescript
   import { useIsFirefox } from '@/hooks/useIsFirefox';
   import { useReducedMotion } from '@/hooks/useReducedMotion';
   ```
4. Inside component, after existing hooks:
   ```typescript
   const isFirefox = useIsFirefox();
   const prefersReducedMotion = useReducedMotion();
   const useSimplifiedAnimations = isFirefox || prefersReducedMotion;
   ```
5. Replace ALL occurrences of `isFirefox` with `useSimplifiedAnimations` in the JSX (lines 70, 71, 76, 95, 150, 155, 156, 158, 166, 225, 241)

**ShaderBackground.tsx:**
1. Remove `useState` import usage for Firefox detection
2. Remove local Firefox detection state and useEffect (lines 8, 11-15)
3. Add imports:
   ```typescript
   import { useIsFirefox } from '@/hooks/useIsFirefox';
   import { useReducedMotion } from '@/hooks/useReducedMotion';
   ```
4. Inside component:
   ```typescript
   const isFirefox = useIsFirefox();
   const prefersReducedMotion = useReducedMotion();
   const useSimplifiedAnimations = isFirefox || prefersReducedMotion;
   ```
5. Replace `isFirefox` checks with `useSimplifiedAnimations` (lines 19, 150, 153)
6. Update the useEffect dependency array to use `useSimplifiedAnimations` instead of `isFirefox`

**DiceRoller3D.tsx:**
1. Remove local `useIsFirefox` function (lines 7-13)
2. Remove `useMemo` from imports (no longer needed for local hook)
3. Add imports:
   ```typescript
   import { useIsFirefox } from '@/hooks/useIsFirefox';
   import { useReducedMotion } from '@/hooks/useReducedMotion';
   ```
4. Inside `DiceRoller3D` component (the main exported one, around line 283):
   ```typescript
   const isFirefox = useIsFirefox();
   const prefersReducedMotion = useReducedMotion();
   const useSimplifiedAnimations = isFirefox || prefersReducedMotion;
   ```
5. Update prop passed to `Dice3D` components: change `isFirefox={isFirefox}` to `isFirefox={useSimplifiedAnimations}` (line 368)
   - Note: Keep the prop name as `isFirefox` to avoid changing the internal Dice3D component interface, but pass the combined value

**Important:** The Dice3D internal component receives `isFirefox` as a prop - we only need to change what we pass to it, not its internal logic.
  </action>
  <verify>
Run grep to confirm no local Firefox detection remains in component files:
```bash
grep -n "navigator.userAgent.*firefox" src/components/DudoOverlay.tsx src/components/ShaderBackground.tsx src/components/DiceRoller3D.tsx
```
Should return no results.

Confirm imports exist:
```bash
grep -n "from '@/hooks/useIsFirefox'" src/components/DudoOverlay.tsx src/components/ShaderBackground.tsx src/components/DiceRoller3D.tsx
```
Should show import in all 3 files.
  </verify>
  <done>
- DudoOverlay imports useIsFirefox and useReducedMotion from /src/hooks/
- ShaderBackground imports useIsFirefox and useReducedMotion from /src/hooks/
- DiceRoller3D imports useIsFirefox and useReducedMotion from /src/hooks/
- All three use `useSimplifiedAnimations = isFirefox || prefersReducedMotion` pattern
- No local Firefox detection functions remain
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify consolidation and build</name>
  <files>None (verification only)</files>
  <action>
Run comprehensive verification to confirm:

1. **No duplicate Firefox detection** - Only the shared hook should contain navigator.userAgent check:
   ```bash
   grep -r "navigator.userAgent.*firefox" src/ --include="*.tsx" --include="*.ts"
   ```
   Expected: Only `src/hooks/useIsFirefox.ts` appears

2. **All components import from shared hooks**:
   ```bash
   grep -r "from '@/hooks/useIsFirefox'" src/components/ --include="*.tsx"
   ```
   Expected: 10 files total (7 existing + 3 migrated)

3. **Build succeeds**:
   ```bash
   npm run build
   ```
   Expected: Build completes without TypeScript errors

4. **Type check passes**:
   ```bash
   npx tsc --noEmit
   ```
   Expected: No type errors
  </action>
  <verify>
All verification commands pass:
- Grep for duplicate Firefox detection returns only useIsFirefox.ts
- Grep for shared hook imports shows all 10 animated components
- npm run build succeeds
- TypeScript type check passes
  </verify>
  <done>
- Single source of truth: useIsFirefox.ts is the only Firefox detection in codebase
- All animated components use shared hooks
- Build and type checks pass
  </done>
</task>

</tasks>

<verification>
Phase 16 success criteria from ROADMAP.md:

1. **A single useIsFirefox hook exists in /src/hooks/ and is the only Firefox detection in the codebase**
   - Verify: `grep -r "navigator.userAgent.*firefox" src/` returns only `src/hooks/useIsFirefox.ts`

2. **DudoOverlay, ShaderBackground, and DiceRoller3D all import from the shared hook**
   - Verify: `grep "from '@/hooks/useIsFirefox'" src/components/{DudoOverlay,ShaderBackground,DiceRoller3D}.tsx` shows all 3

3. **A useReducedMotion hook exists and all animated components respect prefers-reduced-motion**
   - Verify: `grep "from '@/hooks/useReducedMotion'" src/components/{DudoOverlay,ShaderBackground,DiceRoller3D}.tsx` shows all 3

4. **No duplicate Firefox detection logic remains in component files**
   - Verify: `grep "function useIsFirefox" src/components/` returns no results
</verification>

<success_criteria>
- [ ] DudoOverlay.tsx uses shared useIsFirefox and useReducedMotion hooks
- [ ] ShaderBackground.tsx uses shared useIsFirefox and useReducedMotion hooks
- [ ] DiceRoller3D.tsx uses shared useIsFirefox and useReducedMotion hooks
- [ ] No local Firefox detection functions in any component file
- [ ] All 3 components use `useSimplifiedAnimations` pattern
- [ ] npm run build succeeds
- [ ] TypeScript type check passes
</success_criteria>

<output>
After completion, create `.planning/phases/16-shared-hooks/16-01-SUMMARY.md`
</output>
