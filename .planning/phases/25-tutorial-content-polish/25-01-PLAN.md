---
phase: 25-tutorial-content-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/tutorial/script.ts
  - src/lib/tutorial/types.ts
  - src/stores/tutorialStore.ts
autonomous: true

must_haves:
  truths:
    - "Tutorial teaches wild ones rule (1s count as any face value)"
    - "Tutorial teaches Calza (exact match challenge)"
    - "Teaching order is Bid -> Dudo -> Ones -> Calza"
    - "Tutorial explains counting with wild ones"
  artifacts:
    - path: "src/lib/tutorial/script.ts"
      provides: "Expanded tutorial script with ones and calza steps"
      contains: "round2-roll|ones-bid|calza-intro|calza-call"
    - path: "src/lib/tutorial/types.ts"
      provides: "Extended target element type for calza-button"
      contains: "calza-button"
    - path: "src/stores/tutorialStore.ts"
      provides: "Updated totalSteps matching new script length"
  key_links:
    - from: "src/lib/tutorial/script.ts"
      to: "src/lib/tutorial/types.ts"
      via: "TutorialStep type"
      pattern: "TutorialScript"
    - from: "src/stores/tutorialStore.ts"
      to: "src/lib/tutorial/script.ts"
      via: "totalSteps must match steps.length"
      pattern: "totalSteps.*\\d+"
---

<objective>
Expand tutorial script to teach wild ones and Calza rules

Purpose: Complete the tutorial content so users learn all core Perudo rules per CONTEXT.md order (Bid -> Dudo -> Ones -> Calza)
Output: Extended tutorial script with ~14-15 steps teaching all rules, updated types, synchronized store
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-tutorial-content-polish/25-CONTEXT.md
@.planning/phases/25-tutorial-content-polish/25-RESEARCH.md

@src/lib/tutorial/script.ts
@src/lib/tutorial/types.ts
@src/stores/tutorialStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update TutorialTooltipData type to support calza-button target</name>
  <files>src/lib/tutorial/types.ts</files>
  <action>
    Add 'calza-button' to the targetElement union type in TutorialTooltipData interface:

    ```typescript
    targetElement: 'player-dice' | 'bid-button' | 'dudo-button' | 'calza-button' | 'bid-display' | 'opponent-dice';
    ```

    Also add 'calza' to the highlightButton type in TutorialStep interface:

    ```typescript
    highlightButton?: 'bid' | 'dudo' | 'calza';
    ```

    This enables the script to target and highlight the Calza button in later steps.
  </action>
  <verify>TypeScript compilation passes: `npx tsc --noEmit`</verify>
  <done>types.ts has calza-button in targetElement union and calza in highlightButton union</done>
</task>

<task type="auto">
  <name>Task 2: Add wild ones teaching steps to tutorial script</name>
  <files>src/lib/tutorial/script.ts</files>
  <action>
    After the current 'reveal' step (step 8), add new steps to teach wild ones. The current script ends with a successful Dudo call. Now start "round 2" with new dice that include wild 1s.

    Add these steps after step 8 ('reveal'):

    Step 9: 'round2-roll' - New round introduction with wild ones
    - playerDice: [1, 1, 5, 5, 3] (two 1s that are wild, two 5s)
    - opponentDice: [[3, 3, 1, 6, 2], [5, 4, 4, 2, 6]] (Alex has one 1, Sam has one 5)
    - requiredAction: { type: 'wait' }
    - currentBid: null
    - tooltip: "New round! Notice the 1s in your hand - they're WILD! Ones count as any face value. Your two 1s can count as 5s, 3s, or whatever you need."
    - position: 'top', targetElement: 'player-dice', dismissMode: 'click'
    - highlightDice: { type: 'jokers', targets: ['player'] }

    Step 10: 'ones-bid' - Player bids using wild ones
    - Same dice as step 9
    - requiredAction: { type: 'bid', bid: { count: 5, value: 5 } }
    - currentBid: null
    - tooltip: "You have two 5s + two wild 1s = four 5s in your hand alone! Sam has one more. Let's bid 5x fives."
    - position: 'top', targetElement: 'bid-button', dismissMode: 'click'
    - highlightDice: { type: 'matching-value', value: 5, targets: ['player', 1] }
    - highlightButton: 'bid'

    Step 11: 'ones-ai-dudo' - Alex calls Dudo (incorrectly - our bid is good)
    - Same dice as step 9
    - requiredAction: { type: 'wait' }
    - scriptedAIMoves: [{ type: 'dudo' }]
    - currentBid: { count: 5, value: 5 }
    - lastBidder: 'player'
    - tooltip: "Alex calls Dudo! He doesn't believe there are five 5s..."
    - position: 'bottom', targetElement: 'bid-display', dismissMode: 'auto', autoAdvanceDelay: 2000

    Step 12: 'ones-reveal' - Reveal showing wild ones counting
    - Same dice
    - requiredAction: { type: 'wait' }
    - currentBid: { count: 5, value: 5 }
    - lastBidder: 'player'
    - highlightDice: { type: 'matching-value', value: 5, targets: ['player', 0, 1] }
    - NOTE: This reveal will show 5 matching (player: 2 fives + 2 ones = 4, Sam: 1 five = 5 total)

    Per CONTEXT.md tone: "Playful & encouraging", "Direct 'you' voice", "Brief explanations: 1-2 sentences"
  </action>
  <verify>TypeScript compilation passes: `npx tsc --noEmit`</verify>
  <done>script.ts has round2-roll, ones-bid, ones-ai-dudo, ones-reveal steps with correct dice values and tooltips</done>
</task>

<task type="auto">
  <name>Task 3: Add Calza teaching steps to tutorial script</name>
  <files>src/lib/tutorial/script.ts</files>
  <action>
    After the ones-reveal step, add Calza teaching steps. Start a new round 3 with dice arranged so the player can make a successful Calza call.

    Step 13: 'round3-roll' - Round 3 setup for Calza
    - playerDice: [4, 4, 2, 6, 3] (two 4s)
    - opponentDice: [[4, 1, 5, 5, 2], [3, 3, 6, 6, 1]] (Alex: 1 four + 1 wild = 2 fours; Sam: 1 wild = 1 four)
    - requiredAction: { type: 'wait' }
    - currentBid: null
    - roundStarter: 0 (Alex starts this round)
    - tooltip: "Round 3! Watch what happens..."
    - position: 'bottom', targetElement: 'opponent-dice', dismissMode: 'auto', autoAdvanceDelay: 1500

    Step 14: 'alex-bids-calza' - Alex bids
    - Same dice
    - requiredAction: { type: 'wait' }
    - scriptedAIMoves: [{ type: 'bid', bid: { count: 3, value: 4 } }]
    - currentBid: null
    - lastBidder: undefined
    - tooltip: "Alex is thinking..."
    - position: 'bottom', targetElement: 'opponent-dice', dismissMode: 'auto', autoAdvanceDelay: 2000
    - highlightDice: { type: 'matching-value', value: 4, targets: [0] }

    Step 15: 'sam-bids-calza' - Sam bids (reaches exactly 5x fours)
    - Same dice
    - requiredAction: { type: 'wait' }
    - scriptedAIMoves: [{ type: 'bid', bid: { count: 5, value: 4 } }]
    - currentBid: { count: 3, value: 4 }
    - lastBidder: 0
    - tooltip: "Sam is thinking..."
    - position: 'bottom', targetElement: 'opponent-dice', dismissMode: 'auto', autoAdvanceDelay: 2000
    - highlightDice: { type: 'matching-value', value: 4, targets: [1] }

    Step 16: 'calza-intro' - Introduce Calza concept
    - Same dice
    - requiredAction: { type: 'wait' }
    - currentBid: { count: 5, value: 4 }
    - lastBidder: 1
    - tooltip: "One more trick: CALZA! Call it when you think the bid is EXACTLY right. Get it right and you gain a die. Get it wrong and you lose one."
    - position: 'bottom', targetElement: 'bid-display', dismissMode: 'click'

    Step 17: 'calza-call' - Player calls Calza
    - Same dice
    - requiredAction: { type: 'calza' }
    - currentBid: { count: 5, value: 4 }
    - lastBidder: 1
    - tooltip: "Count the 4s (including wilds): You=2, Alex=2, Sam=1. Exactly 5! Call CALZA!"
    - position: 'top', targetElement: 'calza-button', dismissMode: 'click'
    - highlightDice: { type: 'matching-value', value: 4, targets: ['player', 0, 1] }
    - highlightButton: 'calza'

    Step 18: 'calza-reveal' - Final reveal (Calza success)
    - Same dice
    - requiredAction: { type: 'wait' }
    - currentBid: { count: 5, value: 4 }
    - lastBidder: 1
    - highlightDice: { type: 'matching-value', value: 4, targets: ['player', 0, 1] }

    Total new steps: 10 (steps 9-18), bringing total from 9 to 19 steps.
  </action>
  <verify>TypeScript compilation passes: `npx tsc --noEmit`, script exports correctly</verify>
  <done>script.ts has complete Calza teaching sequence (round3-roll through calza-reveal)</done>
</task>

<task type="auto">
  <name>Task 4: Update tutorialStore totalSteps to match expanded script</name>
  <files>src/stores/tutorialStore.ts</files>
  <action>
    Update the totalSteps initial value from 9 to 19 (matching the new TUTORIAL_SCRIPT.steps.length).

    Change line:
    ```typescript
    totalSteps: 9, // Matches TUTORIAL_SCRIPT.steps.length
    ```

    To:
    ```typescript
    totalSteps: 19, // Matches TUTORIAL_SCRIPT.steps.length (9 original + 10 new for ones/calza)
    ```

    This ensures the store knows when tutorial is complete.
  </action>
  <verify>TypeScript compilation passes: `npx tsc --noEmit`</verify>
  <done>tutorialStore.ts has totalSteps: 19</done>
</task>

</tasks>

<verification>
1. TypeScript: `npx tsc --noEmit` passes
2. Build: `npm run build` succeeds
3. Content check: script.ts contains all 19 steps in correct order
4. Type safety: types.ts has calza-button and calza highlight support
5. Store sync: tutorialStore totalSteps = 19
</verification>

<success_criteria>
- Tutorial script expanded from 9 to 19 steps
- Steps 9-12 teach wild ones (1s count as any value)
- Steps 13-18 teach Calza (exact match challenge)
- Types updated to support calza-button targeting
- Store totalSteps synchronized with script length
- All tooltips follow CONTEXT.md tone (playful, direct 'you', brief)
</success_criteria>

<output>
After completion, create `.planning/phases/25-tutorial-content-polish/25-01-SUMMARY.md`
</output>
